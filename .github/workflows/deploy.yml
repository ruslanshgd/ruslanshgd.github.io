name: Deploy Hugo site to Pages

on:
  push:
    branches:
      - main
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages-${{ github.repository }}"
  cancel-in-progress: true

defaults:
  run:
    shell: bash

jobs:
  build:
    runs-on: ubuntu-latest
    env:
      HUGO_VERSION: 0.128.0
    steps:
      - name: Install Hugo CLI
        run: |
          wget -O ${{ runner.temp }}/hugo.deb https://github.com/gohugoio/hugo/releases/download/v${HUGO_VERSION}/hugo_extended_${HUGO_VERSION}_linux-amd64.deb
          sudo dpkg -i ${{ runner.temp }}/hugo.deb
      - name: Install Dart Sass
        run: sudo snap install dart-sass
      - name: Checkout
        uses: actions/checkout@v4
        with:
          submodules: recursive
          fetch-depth: 0
      - name: Setup Pages
        id: pages
        uses: actions/configure-pages@v5
      - name: Sync template files from template repository
        env:
          TEMPLATE_OWNER: ${{ vars.TEMPLATE_OWNER || 'ruslanshgd' }}
          TEMPLATE_REPO: ${{ vars.TEMPLATE_REPO || 'iziPortfolio-template' }}
        run: |
          echo "üîÑ Syncing template files from ${TEMPLATE_OWNER}/${TEMPLATE_REPO}..."
          
          # Create directories if they don't exist
          mkdir -p layouts/_default
          mkdir -p layouts/partials
          mkdir -p static/css
          
          # Base URL for raw GitHub content
          BASE_URL="https://raw.githubusercontent.com/${TEMPLATE_OWNER}/${TEMPLATE_REPO}/main"
          
          # Sync layout files (except site-header.html which is handled via base64 below)
          echo "üìù Syncing Hugo templates..."
          curl -sL "${BASE_URL}/layouts/index.html" -o layouts/index.html || echo "‚ö†Ô∏è Could not fetch layouts/index.html"
          curl -sL "${BASE_URL}/layouts/_default/baseof.html" -o layouts/_default/baseof.html || echo "‚ö†Ô∏è Could not fetch layouts/_default/baseof.html"
          curl -sL "${BASE_URL}/layouts/partials/head.html" -o layouts/partials/head.html || echo "‚ö†Ô∏è Could not fetch layouts/partials/head.html"
          # site-header.html is NOT synced via curl - it's handled via base64 below to ensure correct RelPermalink
          curl -sL "${BASE_URL}/layouts/partials/career-section.html" -o layouts/partials/career-section.html || echo "‚ö†Ô∏è Could not fetch layouts/partials/career-section.html"
          curl -sL "${BASE_URL}/layouts/partials/education-section.html" -o layouts/partials/education-section.html || echo "‚ö†Ô∏è Could not fetch layouts/partials/education-section.html"
          
          echo ""
          echo "üìÅ Final layouts structure:"
          find layouts -type f -name "*.html" | head -20
          
          # Base64 encoded templates (to avoid YAML syntax issues with Hugo {{ }})
          # IMPORTANT: All default values must be in quotes, e.g. default "value"
          # layouts/index.html
          INDEX_B64="e3sgZGVmaW5lICJtYWluIiB9fQogIHt7ICRjYXNlc1NlY3Rpb24gOj0gLlNpdGUuR2V0UGFnZSAic2VjdGlvbiIgImNhc2VzIiB9fQogIHt7ICRjYXNlcyA6PSB3aGVyZSAkY2FzZXNTZWN0aW9uLlJlZ3VsYXJQYWdlcyAiUGFyYW1zLnR5cGUiICJjYXNlIiB9fQogIDxkaXYgY2xhc3M9ImhvbWUiPgogICAgPGRpdiBjbGFzcz0iaG9tZS1oZXJvLXdyYXAiPgogICAgPHNlY3Rpb24gY2xhc3M9ImhvbWUtaGVybyBwb3J0Zm9saW8tY29udGVudCI+CiAgICAgIHt7IHdpdGggc2l0ZS5QYXJhbXMuYXV0aG9yX2ltYWdlIH19CiAgICAgIDxkaXYgY2xhc3M9ImhvbWUtaGVyb19faW50cm8taW1hZ2UiPgogICAgICAgIDxpbWcgc3JjPSJ7eyAuIHwgcmVsVVJMIH19IiBhbHQ9Int7IHNpdGUuUGFyYW1zLmF1dGhvcl9uYW1lIHwgZGVmYXVsdCAi0JDQstGC0L7RgCIgfX0iPgogICAgICA8L2Rpdj4KICAgICAge3sgZW5kIH19CiAgICAgIDxkaXYgY2xhc3M9ImhvbWUtaGVyb19fY29udGVudCI+CiAgICAgICAgPGgxIGNsYXNzPSJob21lLWhlcm9fX3RpdGxlIj4KICAgICAgICAgINCf0YDQuNCy0LXRgiwg0Y8ge3sgc2l0ZS5QYXJhbXMuYXV0aG9yX25hbWUgfCBkZWZhdWx0ICLQmNC80Y8iIH19LCB7eyBzaXRlLlBhcmFtcy5hdXRob3JfZ3JhZGUgfCBkZWZhdWx0ICLQv9GA0L7QtNGD0LrRgtC+0LLRi9C5INC00LjQt9Cw0LnQvdC10YAiIH19IDxzcGFuIGNsYXNzPSJob21lLWhlcm9fX2xvY2F0aW9uIj7wn5ONIHt7IHNpdGUuUGFyYW1zLmF1dGhvcl9jaXR5IHwgZGVmYXVsdCAi0JPQvtGA0L7QtCIgfX08L3NwYW4+CiAgICAgICAgPC9oMT4KICAgICAgICB7eyB3aXRoIHNpdGUuUGFyYW1zLmF1dGhvcl9pbnRybyB9fQogICAgICAgIDxkaXYgY2xhc3M9ImhvbWUtaGVyb19faW50cm8tdGV4dCI+CiAgICAgICAgICB7eyAuIHwgc2FmZUhUTUwgfX0KICAgICAgICA8L2Rpdj4KICAgICAgICB7eyBlbmQgfX0KICAgICAgPC9kaXY+CiAgICA8L3NlY3Rpb24+CiAgICA8L2Rpdj4KCiAgICA8c2VjdGlvbiBjbGFzcz0iaG9tZS1jYXNlcyBwb3J0Zm9saW8tY29udGVudCI+CiAgICAgIDx1bCBjbGFzcz0iY2FzZS1jYXJkcyI+CiAgICAgICAge3sgcmFuZ2Ugd2hlcmUgJGNhc2VzICJQYXJhbXMudHlwZSIgImNhc2UiIH19CiAgICAgICAge3sgJHBhZ2UgOj0gLiB9fQogICAgICAgIHt7ICRpbWcgOj0gZmFsc2UgfX0KICAgICAgICB7eyB3aXRoICRwYWdlLlBhcmFtcy5jYXJkX2ltYWdlIH19e3sgJGltZyA9IHBhcnRpYWwgImdldC1pbWFnZS1yZXNvdXJjZS5odG1sIiAoZGljdCAicGFnZSIgJHBhZ2UgInBhdGgiIC4gImNvbnRleHQiICJjYXJkIikgfX17eyBlbmQgfX0KICAgICAgICB7eyBpZiBub3QgJGltZyB9fXt7IHdpdGggJHBhZ2UuUGFyYW1zLmNvdmVyX2ltYWdlIH19e3sgJGltZyA9IHBhcnRpYWwgImdldC1pbWFnZS1yZXNvdXJjZS5odG1sIiAoZGljdCAicGFnZSIgJHBhZ2UgInBhdGgiIC4gImNvbnRleHQiICJjb3ZlciIpIH19e3sgZW5kIH19e3sgZW5kIH19CiAgICAgICAge3sgaWYgbm90ICRpbWcgfX17eyB3aXRoICRwYWdlLlBhcmFtcy5jb3Zlcl9pY29uIH19e3sgJGltZyA9IHBhcnRpYWwgImdldC1pbWFnZS1yZXNvdXJjZS5odG1sIiAoZGljdCAicGFnZSIgJHBhZ2UgInBhdGgiIC4gImNvbnRleHQiICJjb3ZlciIpIH19e3sgZW5kIH19e3sgZW5kIH19CiAgICAgICAge3sgJHBsYXRmb3JtIDo9ICRwYWdlLlBhcmFtcy5wbGF0Zm9ybSB8IGRlZmF1bHQgIndlYiIgfX0KICAgICAgICB7eyAkbGF5b3V0IDo9ICRwYWdlLlBhcmFtcy5sYXlvdXQgfCBkZWZhdWx0ICJjZW50ZXIiIH19CiAgICAgICAge3sgJGltZ1dpZHRoIDo9IDAgfX0KICAgICAgICB7eyBpZiAkaW1nIH19e3sgJGltZ1dpZHRoID0gJGltZy5XaWR0aCB9fXt7IGVuZCB9fQogICAgICAgIDxsaSBjbGFzcz0iY2FzZS1jYXJkIGNhc2UtY2FyZC0te3sgJHBsYXRmb3JtIH19IGNhc2UtY2FyZC0tbGF5b3V0LXt7ICRsYXlvdXQgfX0ie3sgaWYgYW5kICRpbWcgKGxlICRpbWdXaWR0aCA3NjgpIH19IGRhdGEtaW1hZ2Utd2lkdGg9Int7ICRpbWdXaWR0aCB9fSJ7eyBlbmQgfX0+CiAgICAgICAgICA8YSBjbGFzcz0iY2FzZS1jYXJkX19saW5rIiBocmVmPSJ7eyAkcGFnZS5SZWxQZXJtYWxpbmsgfX0iPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJjYXNlLWNhcmRfX2JvZHkiPgogICAgICAgICAgICAgIHt7IHdpdGggJHBhZ2UuUGFyYW1zLmNvbXBhbnlfbmFtZSB9fTxwIGNsYXNzPSJjYXNlLWNhcmRfX2NvbXBhbnkiPnt7IC4gfX08L3A+e3sgZW5kIH19CiAgICAgICAgICAgICAgPGgyIGNsYXNzPSJjYXNlLWNhcmRfX3RpdGxlIj57eyAkcGFnZS5UaXRsZSB9fTwvaDI+CiAgICAgICAgICAgICAge3sgd2l0aCAkcGFnZS5QYXJhbXMuY292ZXJfc3VidGl0bGUgfX08cCBjbGFzcz0iY2FzZS1jYXJkX19kZXNjIj57eyAuIH19PC9wPnt7IGVuZCB9fQogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2FzZS1jYXJkX19pbWFnZS13cmFwIj4KICAgICAgICAgICAgICB7eyBpZiAkaW1nIH19CiAgICAgICAgICAgICAgICA8aW1nIGNsYXNzPSJjYXNlLWNhcmRfX2ltYWdlIiBzcmM9Int7ICRpbWcuUmVsUGVybWFsaW5rIH19IiBhbHQ9IiJ7eyBpZiBsZSAkaW1nV2lkdGggNzY4IH19IGRhdGEtbW9iaWxlPSJ0cnVlInt7IGVuZCB9fT4KICAgICAgICAgICAgICB7eyBlbHNlIH19CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjYXNlLWNhcmRfX2ltYWdlIGNhc2UtY2FyZF9faW1hZ2UtLXBsYWNlaG9sZGVyIiBhcmlhLWhpZGRlbj0idHJ1ZSI+PC9kaXY+CiAgICAgICAgICAgICAge3sgZW5kIH19CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPC9hPgogICAgICAgIDwvbGk+CiAgICAgICAge3sgZW5kIH19CiAgICAgIDwvdWw+CiAgICA8L3NlY3Rpb24+CgogICAge3sgcGFydGlhbCAiY2FyZWVyLXNlY3Rpb24uaHRtbCIgLiB9fQogICAge3sgcGFydGlhbCAiZWR1Y2F0aW9uLXNlY3Rpb24uaHRtbCIgLiB9fQogIDwvZGl2Pgp7eyBlbmQgfX0K"
          
          # layouts/_default/baseof.html
          BASEOF_B64="PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9Int7IHNpdGUuTGFuZ3VhZ2UuTGFuZyB9fSI+CiAgPGhlYWQ+CiAgICB7eyBwYXJ0aWFsICJoZWFkLmh0bWwiIC4gfX0KICA8L2hlYWQ+CiAgPGJvZHk+CiAgICA8ZGl2IGNsYXNzPSJwb3J0Zm9saW8tY29udGFpbmVyIj4KICAgICAgPGhlYWRlciBjbGFzcz0ic2l0ZS1oZWFkZXIgcG9ydGZvbGlvLWNvbnRlbnQiPgogICAgICAgIHt7IHBhcnRpYWwgInNpdGUtaGVhZGVyLmh0bWwiIC4gfX0KICAgICAgPC9oZWFkZXI+CiAgICAgIDxtYWluIGNsYXNzPSJwb3J0Zm9saW8tY29udGVudCI+CiAgICAgICAge3sgYmxvY2sgIm1haW4iIC4gfX17eyBlbmQgfX0KICAgICAgPC9tYWluPgogICAgICA8Zm9vdGVyIGNsYXNzPSJzaXRlLWZvb3RlciBwb3J0Zm9saW8tY29udGVudCI+CiAgICAgICAge3sgcGFydGlhbCAic2l0ZS1oZWFkZXIuaHRtbCIgLiB9fQogICAgICA8L2Zvb3Rlcj4KICAgIDwvZGl2PgogIDwvYm9keT4KPC9odG1sPgo="
          
          # layouts/partials/head.html
          HEAD_B64="PG1ldGEgY2hhcnNldD0idXRmLTgiPgo8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEiPgo8dGl0bGU+e3sgaWYgLklzSG9tZSB9fXt7IHNpdGUuUGFyYW1zLmF1dGhvcl9uYW1lIH19e3sgd2l0aCBzaXRlLlBhcmFtcy5hdXRob3Jfc3VybmFtZSB9fSB7eyAuIH19e3sgZW5kIH19e3sgd2l0aCBzaXRlLlBhcmFtcy5hdXRob3JfZ3JhZGUgfX0g4oCTIHt7IC4gfX17eyBlbmQgfX17eyBlbHNlIH19e3sgLlRpdGxlIH19IHwge3sgc2l0ZS5QYXJhbXMuYXV0aG9yX25hbWUgfX17eyB3aXRoIHNpdGUuUGFyYW1zLmF1dGhvcl9zdXJuYW1lIH19IHt7IC4gfX17eyBlbmQgfX17eyB3aXRoIHNpdGUuUGFyYW1zLmF1dGhvcl9ncmFkZSB9fSDigJMge3sgLiB9fXt7IGVuZCB9fXt7IGVuZCB9fTwvdGl0bGU+CjxsaW5rIHJlbD0ic3R5bGVzaGVldCIgaHJlZj0ie3sgImNzcy9tYWluLmNzcyIgfCByZWxVUkwgfX0iPgo="
          
          # layouts/partials/site-header.html
          SITEHEADER_B64="PGEgaHJlZj0ie3sgLlNpdGUuSG9tZS5SZWxQZXJtYWxpbmsgfX0iIGNsYXNzPSJzaXRlLWhlYWRlcl9fbmFtZSI+e3sgc2l0ZS5QYXJhbXMuYXV0aG9yX25hbWUgfCBkZWZhdWx0IHNpdGUuVGl0bGUgfX08L2E+CjxuYXYgY2xhc3M9InNpdGUtaGVhZGVyX19uYXYiPgogIHt7IHdpdGggc2l0ZS5QYXJhbXMuYXV0aG9yX2VtYWlsIH19PGEgaHJlZj0ibWFpbHRvOnt7IC4gfX0iPtCf0L7Rh9GC0LA8L2E+e3sgZW5kIH19CiAge3sgd2l0aCBzaXRlLlBhcmFtcy5hdXRob3JfdGVsZWdyYW0gfX08YSBocmVmPSJ7eyAuIH19IiB0YXJnZXQ9Il9ibGFuayIgcmVsPSJub29wZW5lciI+VGVsZWdyYW08L2E+e3sgZW5kIH19CiAge3sgd2l0aCBzaXRlLlBhcmFtcy5hdXRob3JfbGlua2VkaW4gfX08YSBocmVmPSJ7eyAuIH19IiB0YXJnZXQ9Il9ibGFuayIgcmVsPSJub29wZW5lciI+TGluZ2VkSW48L2E+e3sgZW5kIH19CiAge3sgd2l0aCBzaXRlLlBhcmFtcy5hdXRob3JfYmVoYW5jZSB9fTxhIGhyZWY9Int7IC4gfX0iIHRhcmdldD0iX2JsYW5rIiByZWw9Im5vb3BlbmVyIj5CZWhhbmNlPC9hPnt7IGVuZCB9fQogIHt7IHdpdGggc2l0ZS5QYXJhbXMuYXV0aG9yX2RyaWJiYmxlIH19PGEgaHJlZj0ie3sgLiB9fSIgdGFyZ2V0PSJfYmxhbmsiIHJlbD0ibm9vcGVuZXIiPkRyaWJiYmxlPC9hPnt7IGVuZCB9fQogIHt7IHdpdGggc2l0ZS5QYXJhbXMuYXV0aG9yX2N2IH19PGEgaHJlZj0ie3sgLiB9fSIgdGFyZ2V0PSJfYmxhbmsiIHJlbD0ibm9vcGVuZXIiPkNWPC9hPnt7IGVuZCB9fQo8L25hdj4K"
          
          # layouts/partials/career-section.html
          CAREER_B64="e3svKiAKICBDYXJlZXIgc2VjdGlvbi4KCiAgU3VwcG9ydHMgdHdvIGRhdGEgc291cmNlczoKICAxKSBwYXJhbXMuY2FyZWVyLml0ZW1zIOKAkyDQt9Cw0L/QvtC70L3Rj9C10YLRgdGPIFRlbGVncmFt4oCR0LHQvtGC0L7QvCDRh9C10YDQtdC3IGh1Z28udG9tbAogIDIpINCU0L7QutGD0LzQtdC90YLRiyDQuNC3INGA0LDQt9C00LXQu9CwIC9jb250ZW50L2NhcmVlciDigJMg0LrQsNC6INGA0LDQvdGM0YjQtQoqL319Cnt7ICRjYXJlZXJTZWN0aW9uIDo9IC5TaXRlLkdldFBhZ2UgInNlY3Rpb24iICJjYXJlZXIiIH19Cnt7ICRlbnRyaWVzIDo9IGNvbmQgKG5lICRjYXJlZXJTZWN0aW9uIG5pbCkgJGNhcmVlclNlY3Rpb24uUmVndWxhclBhZ2VzLkJ5V2VpZ2h0IHNsaWNlIH19Cnt7ICRjYXJlZXJQYXJhbXMgOj0gc2l0ZS5QYXJhbXMuY2FyZWVyIH19Cnt7ICRjYXJlZXJJdGVtcyA6PSBjb25kIChhbmQgKG5lICRjYXJlZXJQYXJhbXMgbmlsKSAoaXNzZXQgJGNhcmVlclBhcmFtcyAiaXRlbXMiKSkgJGNhcmVlclBhcmFtcy5pdGVtcyBzbGljZSB9fQoKe3sgaWYgb3IgKGd0IChsZW4gJGVudHJpZXMpIDApIChndCAobGVuICRjYXJlZXJJdGVtcykgMCkgfX0KPGRpdiBjbGFzcz0iY2FyZWVyLXdyYXAiPgogIDxzZWN0aW9uIGNsYXNzPSJjYXJlZXIgcG9ydGZvbGlvLWNvbnRlbnQiIGFyaWEtbGFiZWxsZWRieT0iY2FyZWVyLWhlYWRpbmciPgogICAgPGgyIGNsYXNzPSJjYXJlZXJfX3RpdGxlIiBpZD0iY2FyZWVyLWhlYWRpbmciPtCa0LDRgNGM0LXRgNCwPC9oMj4KCiAgICB7ey8qIDEuIFJlbmRlciBpdGVtcyBmcm9tIHBhcmFtcy5jYXJlZXIuaXRlbXMsINC10YHQu9C4INC+0L3QuCDQtdGB0YLRjCAqL319CiAgICB7eyBpZiBndCAobGVuICRjYXJlZXJJdGVtcykgMCB9fQogICAgICB7eyByYW5nZSAkY2FyZWVySXRlbXMgfX0KICAgICAgPGFydGljbGUgY2xhc3M9ImNhcmVlci1pdGVtIj4KICAgICAgICA8ZGl2IGNsYXNzPSJjYXJlZXItaXRlbV9fbGVmdCI+CiAgICAgICAgICA8cCBjbGFzcz0iY2FyZWVyLWl0ZW1fX2NvbXBhbnkiPnt7IC5jb21wYW55IH19PC9wPgogICAgICAgICAge3sgd2l0aCAucm9sZSB9fTxwIGNsYXNzPSJjYXJlZXItaXRlbV9fcG9zaXRpb24iPnt7IC4gfX08L3A+e3sgZW5kIH19CiAgICAgICAgICA8cCBjbGFzcz0iY2FyZWVyLWl0ZW1fX2RhdGVzIj4KICAgICAgICAgICAge3stIHdpdGggLnN0YXJ0IH19e3sgLiB9fXt7IGVuZCAtfX0KICAgICAgICAgICAge3stIGlmIG9yIC5zdGFydCAuZW5kIH19ICZtZGFzaDsge3sgZW5kIC19fQogICAgICAgICAgICB7ey0gd2l0aCAuZW5kIH19e3sgLiB9fXt7IGVuZCAtfX0KICAgICAgICAgIDwvcD4KICAgICAgICAgIHt7IHdpdGggLmxvY2F0aW9uIH19PHAgY2xhc3M9ImNhcmVlci1pdGVtX19sb2NhdGlvbiI+e3sgLiB9fTwvcD57eyBlbmQgfX0KICAgICAgICA8L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJjYXJlZXItaXRlbV9fcmlnaHQiPgogICAgICAgICAgPGRpdiBjbGFzcz0iY2FyZWVyLWl0ZW1fX2NvbnRlbnQgcHJvc2UiPgogICAgICAgICAgICB7eyAuZGVzY3JpcHRpb24gfCBtYXJrZG93bmlmeSB9fQogICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvYXJ0aWNsZT4KICAgICAge3sgZW5kIH19CiAgICB7eyBlbHNlIGlmIGd0IChsZW4gJGVudHJpZXMpIDAgfX0KICAgIHt7LyogMi4gRmFsbGJhY2sgdG8gbGVnYWN5IC9jb250ZW50L2NhcmVlciBlbnRyaWVzICovfX0KICAgICAge3sgcmFuZ2UgJGVudHJpZXMgfX0KICAgICAgPGFydGljbGUgY2xhc3M9ImNhcmVlci1pdGVtIj4KICAgICAgICA8ZGl2IGNsYXNzPSJjYXJlZXItaXRlbV9fbGVmdCI+CiAgICAgICAgICB7eyB3aXRoIC5QYXJhbXMubG9nbyB9fQogICAgICAgICAgPGRpdiBjbGFzcz0iY2FyZWVyLWl0ZW1fX2xvZ28iPgogICAgICAgICAgICA8aW1nIHNyYz0ie3sgLiB8IHJlbFVSTCB9fSIgYWx0PSIiIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCI+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICAgIHt7IGVuZCB9fQogICAgICAgICAgPHAgY2xhc3M9ImNhcmVlci1pdGVtX19jb21wYW55Ij57eyAuVGl0bGUgfX08L3A+CiAgICAgICAgICB7eyB3aXRoIC5QYXJhbXMucG9zaXRpb24gfX08cCBjbGFzcz0iY2FyZWVyLWl0ZW1fX3Bvc2l0aW9uIj57eyAuIH19PC9wPnt7IGVuZCB9fQogICAgICAgICAge3sgd2l0aCAuUGFyYW1zLmRhdGVzIH19PHAgY2xhc3M9ImNhcmVlci1pdGVtX19kYXRlcyI+e3sgLiB9fTwvcD57eyBlbmQgfX0KICAgICAgICA8L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJjYXJlZXItaXRlbV9fcmlnaHQiPgogICAgICAgICAgPGRpdiBjbGFzcz0iY2FyZWVyLWl0ZW1fX2NvbnRlbnQgcHJvc2UiPgogICAgICAgICAgICB7eyAuQ29udGVudCB9fQogICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvYXJ0aWNsZT4KICAgICAge3sgZW5kIH19CiAgICB7eyBlbmQgfX0KICA8L3NlY3Rpb24+CjwvZGl2Pgp7eyBlbmQgfX0K"
          
          # layouts/partials/education-section.html
          EDUCATION_B64="e3sgd2l0aCBzaXRlLlBhcmFtcy5lZHVjYXRpb24gfX0KICB7eyAkaGFzQ291cnNlcyA6PSBndCAobGVuIC5jb3Vyc2VzKSAwIH19CiAge3sgJGhhc1VuaXZlcnNpdGllcyA6PSBndCAobGVuIC51bml2ZXJzaXRpZXMpIDAgfX0KICB7eyBpZiBvciAkaGFzQ291cnNlcyAkaGFzVW5pdmVyc2l0aWVzIH19CjxkaXYgY2xhc3M9ImVkdWNhdGlvbi13cmFwIj4KICA8c2VjdGlvbiBjbGFzcz0iZWR1Y2F0aW9uIHBvcnRmb2xpby1jb250ZW50IiBhcmlhLWxhYmVsbGVkYnk9ImVkdWNhdGlvbi1oZWFkaW5nIj4KICAgIDxoMiBjbGFzcz0iZWR1Y2F0aW9uX190aXRsZSIgaWQ9ImVkdWNhdGlvbi1oZWFkaW5nIj7QntCx0YDQsNC30L7QstCw0L3QuNC1PC9oMj4KCiAgICB7eyBpZiAkaGFzQ291cnNlcyB9fQogICAgPGRpdiBjbGFzcz0iZWR1Y2F0aW9uX19ibG9jayBlZHVjYXRpb25fX2Jsb2NrLS1jb3Vyc2VzIj4KICAgICAgPGgzIGNsYXNzPSJlZHVjYXRpb25fX3N1YnRpdGxlIj7QmtGD0YDRgdGLPC9oMz4KICAgICAgPHVsIGNsYXNzPSJlZHVjYXRpb24tbGlzdCBlZHVjYXRpb24tbGlzdC0tY291cnNlcyI+CiAgICAgICAge3sgcmFuZ2UgLmNvdXJzZXMgfX0KICAgICAgICA8bGkgY2xhc3M9ImVkdWNhdGlvbi1saXN0X19pdGVtIj4KICAgICAgICAgIDxwPgogICAgICAgICAgICB7eyBpZiAudXJsIH19CiAgICAgICAgICAgICAgPGEgaHJlZj0ie3sgLnVybCB9fSIgY2xhc3M9ImVkdWNhdGlvbi1saXN0X19saW5rIiB0YXJnZXQ9Il9ibGFuayIgcmVsPSJub29wZW5lciBub3JlZmVycmVyIj57eyAudGl0bGUgfX08L2E+CiAgICAgICAgICAgIHt7IGVsc2UgfX0KICAgICAgICAgICAgICB7eyAudGl0bGUgfX0KICAgICAgICAgICAge3sgZW5kIH19CiAgICAgICAgICAgIHt7IHdpdGggLnByb3ZpZGVyIH19IHt7IC4gfX17eyBlbmQgfX0KICAgICAgICAgICAge3sgaWYgb3IgLnllYXIgLnN0YXR1cyB9fSAmbmRhc2g7IHt7IGlmIC5zdGF0dXMgfX17eyAuc3RhdHVzIH19e3sgZWxzZSB9fXt7IC55ZWFyIH19INCz0L7QtHt7IGVuZCB9fXt7IGVuZCB9fQogICAgICAgICAgICB7eyB3aXRoIC5jZXJ0aWZpY2F0ZSB9fSAmbWRhc2g7IDxhIGhyZWY9Int7IC4gfX0iIGNsYXNzPSJlZHVjYXRpb24tbGlzdF9fY2VydGlmaWNhdGUiIHRhcmdldD0iX2JsYW5rIiByZWw9Im5vb3BlbmVyIG5vcmVmZXJyZXIiPtGB0LXRgNGC0LjRhNC40LrQsNGCPC9hPnt7IGVuZCB9fQogICAgICAgICAgPC9wPgogICAgICAgIDwvbGk+CiAgICAgICAge3sgZW5kIH19CiAgICAgIDwvdWw+CiAgICA8L2Rpdj4KICAgIHt7IGVuZCB9fQoKICAgIHt7IGlmICRoYXNVbml2ZXJzaXRpZXMgfX0KICAgIDxkaXYgY2xhc3M9ImVkdWNhdGlvbl9fYmxvY2sgZWR1Y2F0aW9uX19ibG9jay0tdW5pdmVyc2l0aWVzIj4KICAgICAgPGgzIGNsYXNzPSJlZHVjYXRpb25fX3N1YnRpdGxlIj7Qo9C90LjQstC10YDRgdC40YLQtdGCPC9oMz4KICAgICAgPHVsIGNsYXNzPSJlZHVjYXRpb24tbGlzdCBlZHVjYXRpb24tbGlzdC0tdW5pdmVyc2l0aWVzIj4KICAgICAgICB7eyByYW5nZSAudW5pdmVyc2l0aWVzIH19CiAgICAgICAgPGxpIGNsYXNzPSJlZHVjYXRpb24tbGlzdF9faXRlbSI+CiAgICAgICAgICA8cD4KICAgICAgICAgICAgPGVtPnt7IC5uYW1lIH19IHt7IC55ZWFyIH19INCz0L7QtDwvZW0+CiAgICAgICAgICA8L3A+CiAgICAgICAgICA8cD4KICAgICAgICAgICAge3sgLnNwZWNpYWxpdHkgfX17eyB3aXRoIC5kZWdyZWUgfX0sIHt7IC4gfX17eyBlbmQgfX17eyB3aXRoIC5ub3RlIH19ICZuZGFzaDsge3sgLiB9fXt7IGVuZCB9fQogICAgICAgICAgPC9wPgogICAgICAgIDwvbGk+CiAgICAgICAge3sgZW5kIH19CiAgICAgIDwvdWw+CiAgICA8L2Rpdj4KICAgIHt7IGVuZCB9fQogIDwvc2VjdGlvbj4KPC9kaXY+CiAge3sgZW5kIH19Cnt7IGVuZCB9fQoK"
          
          # Always ensure templates are up-to-date (overwrite to ensure latest version)
          echo "üìù Ensuring all Hugo templates are up-to-date..."
          echo "$INDEX_B64" | base64 -d > layouts/index.html
          echo "‚úÖ Updated layouts/index.html"
          
          echo "$BASEOF_B64" | base64 -d > layouts/_default/baseof.html
          echo "‚úÖ Updated layouts/_default/baseof.html"
          
          echo "$HEAD_B64" | base64 -d > layouts/partials/head.html
          echo "‚úÖ Updated layouts/partials/head.html"
          
          echo "$SITEHEADER_B64" | base64 -d > layouts/partials/site-header.html
          echo "‚úÖ Updated layouts/partials/site-header.html"
          
          echo "$CAREER_B64" | base64 -d > layouts/partials/career-section.html
          echo "‚úÖ Updated layouts/partials/career-section.html"
          
          echo "$EDUCATION_B64" | base64 -d > layouts/partials/education-section.html
          echo "‚úÖ Updated layouts/partials/education-section.html"
          
          echo ""
          echo "üìÅ Final layouts structure:"
          find layouts -type f -name "*.html" | head -20
      - name: Sync CSS from template repository
        env:
          TEMPLATE_OWNER: ${{ vars.TEMPLATE_OWNER || 'ruslanshgd' }}
          TEMPLATE_REPO: ${{ vars.TEMPLATE_REPO || 'iziPortfolio-template' }}
        run: |
          echo "üìù Syncing CSS from template repository..."
          BASE_URL="https://raw.githubusercontent.com/${TEMPLATE_OWNER}/${TEMPLATE_REPO}/main"
          curl -sL "${BASE_URL}/static/css/main.css" -o static/css/main.css || echo "‚ö†Ô∏è Could not fetch CSS from template"
          echo "‚úÖ CSS synced"
      - name: Build with Hugo
        env:
          HUGO_ENVIRONMENT: production
          HUGO_ENV: production
        run: |
          hugo \
            --gc \
            --minify \
            --baseURL "${{ steps.pages.outputs.base_url }}/"
      - name: Verify static files before build
        run: |
          echo "Checking static/images directory:"
          ls -la static/images/ 2>/dev/null || echo "‚ö†Ô∏è static/images/ directory not found"
          echo ""
          echo "Checking for author.jpg in static:"
          ls -la static/images/author.jpg 2>/dev/null || echo "‚ö†Ô∏è static/images/author.jpg not found"
          echo ""
          echo "Checking static/css directory:"
          ls -la static/css/ 2>/dev/null || echo "‚ö†Ô∏è static/css/ directory not found"
      - name: Verify build output
        run: |
          echo "Checking public directory contents:"
          ls -la public/ | head -20
          echo ""
          echo "Checking for index.html:"
          ls -la public/index.html || echo "ERROR: index.html not found!"
          echo ""
          echo "Checking for images directory in public:"
          ls -la public/images/ 2>/dev/null || echo "‚ö†Ô∏è public/images/ directory not found"
          echo ""
          echo "Checking for author.jpg in public:"
          ls -la public/images/author.jpg 2>/dev/null || echo "‚ö†Ô∏è public/images/author.jpg not found - Hugo should copy from static/"
          echo ""
          echo "Checking for CSS in public:"
          ls -la public/css/main.css 2>/dev/null || echo "‚ö†Ô∏è public/css/main.css not found"
          echo ""
          echo "Checking for index.xml:"
          ls -la public/index.xml || echo "index.xml not found"
          echo ""
          echo "File sizes:"
          du -h public/index.html public/index.xml 2>/dev/null || echo "Some files missing"
          echo ""
          echo "First 5 lines of index.html:"
          head -5 public/index.html 2>/dev/null || echo "index.html not readable"
          echo ""
          echo "Checking image path in index.html:"
          grep -o 'src="[^"]*author[^"]*"' public/index.html || echo "‚ö†Ô∏è author image path not found in HTML"
          echo ""
          echo "Checking header link in index.html:"
          grep -o 'href="[^"]*"[^>]*site-header\|site-nav' public/index.html | head -3 || echo "‚ö†Ô∏è header link not found in HTML"
          echo ""
          echo "Verifying index.html is valid HTML:"
          if head -1 public/index.html | grep -qi "<!doctype html>"; then
            echo "‚úÖ index.html starts with DOCTYPE"
          else
            echo "‚ùå ERROR: index.html does not start with DOCTYPE!"
            exit 1
          fi
      - name: Ensure index.html priority
        run: |
          # Move RSS feed to feed.xml to avoid conflict with index.html
          if [ -f public/index.xml ]; then
            mv public/index.xml public/feed.xml
            echo "‚úÖ Moved index.xml to feed.xml to ensure index.html priority"
          fi
          # Verify index.html exists and is first
          if [ ! -f public/index.html ]; then
            echo "‚ùå ERROR: index.html not found after build!"
            exit 1
          fi
          echo "‚úÖ index.html verified and prioritized"
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: ./public

  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
