{{ $page := . }}
{{ $p := $page.Params }}
{{ $coverImg := "" }}
{{ if $p.cover_image }}
  {{ $imgRes := partial "get-image-resource.html" (dict "page" $page "path" $p.cover_image "context" "cover") }}
  {{ if $imgRes }}
    {{ $coverImg = $imgRes.RelPermalink }}
  {{ else }}
    {{ $coverImg = $p.cover_image | relURL }}
  {{ end }}
{{ end }}
<section class="case-cover">
  <div class="case-cover__content">
    {{ with $p.cover_meta }}<p class="case-cover__meta">{{ . }}</p>{{ end }}
    <h1 class="case-cover__title">{{ $p.cover_title | default $page.Title }}</h1>
    {{ with $p.cover_subtitle }}<p class="case-cover__subtitle">{{ . }}</p>{{ end }}
  </div>
  {{ if eq ($p.cover_variant | default "icon") "icon" }}
    {{ with $p.cover_icon }}
      <div class="case-cover__media">
        {{ $imgRes := partial "get-image-resource.html" (dict "page" $page "path" . "context" "cover") }}
        {{ if $imgRes }}
          <img class="case-cover__image" src="{{ $imgRes.RelPermalink }}" alt="">
        {{ else }}
          <img class="case-cover__image" src="{{ . | relURL }}" alt="">
        {{ end }}
      </div>
    {{ end }}
  {{ else if $coverImg }}
    <div class="case-cover__media">
      <img class="case-cover__image" src="{{ $coverImg }}" alt="">
    </div>
  {{ end }}
</section>
